<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Week 2: Palmon - Akashic records: The Solomon book</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../../../favicon.svg">
        
        
        <link rel="shortcut icon" href="../../../favicon.png">
        
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        
        <link rel="stylesheet" href="../../../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../../../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../../index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Development log</li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> October - 2022 </div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../devlog/2022/october/w1.html"><strong aria-hidden="true">1.1.</strong> Week 1: Baal</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> November - 2022</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../devlog/2022/november/w2.html" class="active"><strong aria-hidden="true">2.1.</strong> Week 2: Palmon</a></li><li class="chapter-item expanded "><a href="../../../devlog/2022/november/w3.html"><strong aria-hidden="true">2.2.</strong> Week 3: Beleth</a></li><li class="chapter-item expanded "><a href="../../../devlog/2022/november/w4.html"><strong aria-hidden="true">2.3.</strong> Week 4: Purson</a></li><li class="chapter-item expanded "><a href="../../../devlog/2022/november/w5.html"><strong aria-hidden="true">2.4.</strong> Week 5: Asmodeus</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../../../misc/license.html">License</a></li><li class="chapter-item expanded affix "><a href="../../../misc/code_of_conduct.html">Code of conduct</a></li><li class="chapter-item expanded affix "><a href="../../../misc/contributors.html">Contributors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Akashic records: The Solomon book</h1>

                    <div class="right-buttons">
                        
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/nomadiz/solomon-db//tree/master/doc" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#weekly-update-2-palmon" id="weekly-update-2-palmon">Weekly Update #2: Palmon</a></h1>
<p>Date: November 2022 (1-7/11/2022)</p>
<p align="center">
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/84/Paimon.jpg/180px-Paimon.jpg" width="40%"/>
</p>
<blockquote>
<p>Palmon is one of the Kings of Hell, more obedient to Lucifer than other kings are, and has two hundred legions of demons under his rule. He has a great voice and roars as soon as he comes, speaking in this manner for a while until the conjurer compels him and then he answers clearly the questions he is asked. When a conjurer invokes this demon he must look towards the northwest, the direction of Paimon's house, and when Paimon appears he must be allowed to ask the conjurer what he wishes and be answered, in order to obtain the same from him. - Wikipedia</p>
</blockquote>
<h2><a class="header" href="#commits-on-nov-1-2022" id="commits-on-nov-1-2022">Commits on Nov 1, 2022</a></h2>
<h3><a class="header" href="#description" id="description">Description</a></h3>
<p>The prior implementation of <code>RocksDBDriver</code> was using the database instance initialized using <code>DB</code> object. And all methods are called from the object <code>DB</code> instance too. However, this approach has some limitations in terms of concurrency operations. Briefly, I migrate it from using <code>DB</code> to handling operations using transactions - a better control flow approach. Instead of using <code>TransactionDB</code>, I choose <code>OptimisticTransactionDB</code> which is more efficient for read contention database, correct me if I am wrong.</p>
<p>You can read more about this in <a href="https://github.com/facebook/rocksdb/wiki/Transactions#optimistictransactiondb">RocksDB Wiki</a></p>
<h3><a class="header" href="#detail-explanation" id="detail-explanation">Detail explanation</a></h3>
<p>Even though there is only one commit and only today, this commit has a lot of code refractors. An obvious refractor is migrating from <code>Driver</code> to <code>Adapter</code> which follows adapter pattern.</p>
<ul>
<li><code>StorageDriver</code> to <code>StorageAdapter</code></li>
<li><code>RocksDBDriver</code> to <code>RocksDBAdapter</code></li>
</ul>
<p>Walk through the implementation of <code>StorageAdapter</code>, we have</p>
<pre><code class="language-rs">pub struct StorageAdapter&lt;T&gt; {
    pub name: StorageAdapterName,
    pub db_instance: Pin&lt;Arc&lt;T&gt;&gt;,
    pub variant: StorageVariant,
}
</code></pre>
<p>You may notice the use of generic type <code>Pin&lt;Arc&lt;T&gt;&gt;</code>. Explain more about why I wrote this. <code>Pin</code> trait will pin the object in a memory, which means it can't be move to a different location in a memory, for example, using <code>std::mem::swap</code>. Inside the <code>Pin</code> type, we have <code>Arc</code> or <strong>Atomically Reference Counted</strong>.<code>Arc</code> type shares ownership between threads, which is different from single threaded type <code>Rc</code>. Hence, this is usually used for handling multi-threaded operations and it is suitable for our distributed database design.</p>
<p>New method added to <code>RocksDBAdapter</code> to create a transaction</p>
<pre><code class="language-rs">pub fn transaction(
        self: &amp;'static Self,
        w: bool,
        r: bool,
    ) -&gt; Result&lt;Transaction&lt;TxType&gt;, Error&gt; {
        let inner = self.get_inner();
        let db_instance = &amp;inner.db_instance;
        let tx = db_instance.transaction();

        // The database reference must always outlive
        // the transaction. If it doesn't then this
        // is undefined behaviour. This unsafe block
        // ensures that the transaction reference is
        // static, but will cause a crash if the
        // datastore is dropped prematurely.
        let tx = unsafe {
            std::mem::transmute::&lt;
                rocksdb::Transaction&lt;'_, OptimisticTransactionDB&gt;,
                rocksdb::Transaction&lt;'static, OptimisticTransactionDB&gt;,
            &gt;(tx)
        };

        Ok(Transaction::&lt;TxType&gt;::new(tx, w, r))
    }
</code></pre>
<p>There is a head-aching concept in this method, we have an unsafe method use <code>std::mem::transmute</code>. This is not recommended to use as it transform the lifetime of an object. The reason why we use this method here is because, we need to cast the original lifetime of <code>OptimisticTransactionDB</code> to static as we want the transaction remains as long as it can until the program stops. This is referenced from the source code of <strong>SurrealDB</strong>.</p>
<p>On the other hand, we have an implementation for internal transaction</p>
<pre><code class="language-rs">impl Transaction&lt;TxType&gt;
</code></pre>
<p>Any storage adapter can be understand as a bridge to create transaction, it does not store any transaction value. This separation provides the ability to control a single transaction each operation instead of a whole <code>db_instance</code>.</p>
<h3><a class="header" href="#contributors" id="contributors">Contributors</a></h3>
<ul>
<li>Chung Quan Tin (<a href="https://github.com/chungquantin">@chungquantin</a>)</li>
</ul>
<hr />
<h2><a class="header" href="#commits-on-nov-2-2022" id="commits-on-nov-2-2022">Commits on Nov 2, 2022</a></h2>
<h3><a class="header" href="#description-1" id="description-1">Description</a></h3>
<ul>
<li>Enhancing the development experience by configuring the CI/CD pipeline using Github Actions.</li>
<li>Implement basic methods of RocksDB OptimisticDB transaction</li>
</ul>
<h3><a class="header" href="#detail-explanation-1" id="detail-explanation-1">Detail explanation</a></h3>
<p>There are two workflows added:</p>
<ul>
<li>Formatter (check + apply) workflow: Use <code>cargo clippy</code> and <code>cargo fmt</code> to format and lint the repo.</li>
<li>Test: Run <code>cargo test</code> on the workspace whenever there's an update to <code>master</code> branch</li>
</ul>
<p>Every datastore transaction will be marked generically as DBTransaction or Distributed Database Transaction. This is implied by Solomon DB technical directory. Transaction will implement a trait that requires these below method</p>
<pre><code class="language-rs">// Check if closed
fn closed(&amp;self) -&gt; bool;
// Cancel a transaction
fn cancel(&amp;mut self) -&gt; Result&lt;(), Error&gt;;
// Commit a transaction
fn commit(&amp;mut self) -&gt; Result&lt;(), Error&gt;;
// Check if a key exists
fn exi&lt;K&gt;(&amp;mut self, key: K) -&gt; Result&lt;bool, Error&gt;
where
K: Into&lt;Key&gt;;
// Fetch a key from the database
fn get&lt;K&gt;(&amp;mut self, key: K) -&gt; Result&lt;Option&lt;Val&gt;, Error&gt;;
// Insert or update a key in the database
fn set&lt;K, V&gt;(&amp;mut self, key: K, val: V) -&gt; Result&lt;(), Error&gt;;
// Insert a key if it doesn't exist in the database
fn put&lt;K, V&gt;(&amp;mut self, key: K, val: V) -&gt; Result&lt;(), Error&gt;;
// Delete a key
fn del&lt;K&gt;(&amp;mut self, key: K) -&gt; Result&lt;(), Error&gt;;
</code></pre>
<h3><a class="header" href="#contributors-1" id="contributors-1">Contributors</a></h3>
<ul>
<li>Chung Quan Tin (<a href="https://github.com/chungquantin">@chungquantin</a>)</li>
</ul>
<hr />
<h2><a class="header" href="#commits-on-nov-4-2022" id="commits-on-nov-4-2022">Commits on Nov 4, 2022</a></h2>
<h3><a class="header" href="#description-2" id="description-2">Description</a></h3>
<p>Write a new macro to auto generate test code for datastore adapter. Whenever there's a new datastore implemented, we can add it to the test suite easily by</p>
<pre><code class="language-rs">full_test_impl!(RocksDBAdapter::default());
</code></pre>
<p>This code implementation is referenced from <a href="https://github.com/indradb/indradb/blob/master/lib/src/tests/macros.rs">IndraDB</a>. On the other hand, these commits add a new feature tag called <code>test-suite</code> which must be declared to allow all test runs.</p>
<pre><code class="language-diff">[features]
default = [&quot;kv-rocksdb&quot;]
kv-rocksdb = [&quot;dep:rocksdb&quot;]
+ test-suite = []
</code></pre>
<p>To run <code>cargo test</code> or <code>cargo nextest</code> enabling the <code>test-suite</code> feature, can follow these commands to run</p>
<pre><code class="language-powershell">cargo test --features test-suite
</code></pre>
<pre><code class="language-powershell">cargo nextest run --features test-suite
</code></pre>
<h3><a class="header" href="#detail-explanations" id="detail-explanations">Detail explanations</a></h3>
<p>The logic behind the new macro is not too complicated, the macro <code>define_test!</code> receive any <code>datastore_adapter</code> as an input along with the name for the test. This name is also a name of methods exported from crate <code>tests</code>. This approach is required to overpass the type strictness of <code>DatastoreAdapter</code> as we will support multiple types of datastore adapter.</p>
<pre><code class="language-rs">/// Defines a unit test function.
#[macro_export]
macro_rules! define_test {
	($name:ident, $datastore_adapter:expr) =&gt; {
		#[tokio::test]
		async fn $name() {
			let datastore_adapter = $datastore_adapter;
			$crate::tests::$name(datastore_adapter).await;
		}
	};
}

/// Use this macro to enable the entire standard test suite.
#[macro_export]
macro_rules! full_test_impl {
	($code:expr) =&gt; {
		#[cfg(test)]
		define_test!(should_delete_key, $code);
	};
}
</code></pre>
<h3><a class="header" href="#contributors-2" id="contributors-2">Contributors</a></h3>
<ul>
<li>Chung Quan Tin (<a href="https://github.com/chungquantin">@chungquantin</a>)</li>
</ul>
<hr />
<h2><a class="header" href="#commits-on-nov-5-2022" id="commits-on-nov-5-2022">Commits on Nov 5, 2022</a></h2>
<h3><a class="header" href="#description-3" id="description-3">Description</a></h3>
<p>Introducing a new struct <code>DatastoreManager</code> which is generated using macro <code>impl_datastore_manager</code>. The idea behinds this implementation is to manage all datastore adapter in the cleanest way.</p>
<ul>
<li>Adding method to generate a random datastore path</li>
</ul>
<pre><code class="language-diff">/// Generate a path to store data for RocksDB
fn generate_path(id: Option&lt;i32&gt;) -&gt; String {
	 let random_id: i32 = generate_random_i32();
	 let id = &amp;id.unwrap_or(random_id).to_string();
- String::from(&quot;./.temp/rocks-&quot;) + id + &quot;.db&quot;
+ let path = if cfg!(target_os = &quot;linux&quot;) {
+	 &quot;/dev/shm/&quot;.into()
+ } else {
+	 temp_dir()
+ }
+ .join(format!(&quot;solomon-rocksdb-{}&quot;, id));
+
+	path_to_string(&amp;path).unwrap()
}
</code></pre>
<ul>
<li>Adding column family to RocksDB</li>
</ul>
<p>Adding models for graph related struct: <code>Node - Label - Property - Relationship</code></p>
<h3><a class="header" href="#detail-explanation-2" id="detail-explanation-2">Detail explanation</a></h3>
<h4><a class="header" href="#a-hrefhttpsgithubcomeighteenzirocksdb_wikiblobmastercolumn-familiesmdrocksdb-column-familya" id="a-hrefhttpsgithubcomeighteenzirocksdb_wikiblobmastercolumn-familiesmdrocksdb-column-familya"><a href="https://github.com/EighteenZi/rocksdb_wiki/blob/master/Column-Families.md">RocksDB Column Family</a></a></h4>
<p>As being stated in the RocksDB Wiki:</p>
<blockquote>
<p>Each key-value pair in RocksDB is associated with exactly one Column Family.</p>
</blockquote>
<p>In SolomonDB design, there will be multiple column families specified for different set of data. For example: <strong>vertex, vertex-property, edge, edge-property and</strong> <strong>label</strong>. All methods of RocksDB transaction will include a column family attribute. For example, the <code>get</code> method</p>
<pre><code class="language-diff">/// Fetch a key from the database
- async fn get&lt;K: Into&lt;Key&gt; + Send&gt;(&amp;mut self, key: K) -&gt; Result&lt;Option&lt;Val&gt;, Error&gt;;
+ async fn get&lt;K: Into&lt;Key&gt; + Send&gt;(&amp;mut self, cf: CF, key: K) -&gt; Result&lt;Option&lt;Val&gt;, Error&gt;;
</code></pre>
<h4><a class="header" href="#a-hrefhttpsgithubcomopencypheropencypherblobmasterdocsproperty-graph-modeladocproperty-graph-designa" id="a-hrefhttpsgithubcomopencypheropencypherblobmasterdocsproperty-graph-modeladocproperty-graph-designa"><a href="https://github.com/opencypher/openCypher/blob/master/docs/property-graph-model.adoc">Property Graph Design</a></a></h4>
<p>Not sure but I remember this has been mentioned in a very first commit log, our graph database will follow the structure of <code>Property Graph</code>.</p>
<ul>
<li>
<p><strong>Vertex</strong>: Common object in every graph model. In Property Graph, vertex is more versatile. It has multiple properties, it can be considered as a document in NoSQL database. Vertex can also have multiple labels to identify itself.</p>
</li>
<li>
<p><strong>Relationship</strong>: Or edge in single relational database. Indicates the link between two vertex. However, relationship can have properties too. It also has a type, for example, if two <code>LOVER</code> nodes connect, the relationship type should be <code>LOVE</code>. Defined as <code>source_vertex -&gt; relationship -&gt; target_vertex</code>.</p>
</li>
<li>
<p><strong>Property</strong>: Define attribute type and name of object field. For example, vertex (or node) can have name, age, birthday and relationship can also have name. Structure of <code>property</code> is <code>uuid | name | type</code>. Property of each core objects (node and relationship) will be stored in a <code>HashMap&lt;Uuid, Vec&lt;u8&gt;&gt;</code> where <code>Uuid = Property ID</code> and <code>Vec&lt;u8&gt; = Byte value for that property</code></p>
</li>
<li>
<p><strong>Label</strong>: Vertex can have multiple labels. For example, one vertex can be a Person, Programmer and Employee at the same time. This can be misunderstood with <code>Property</code>. However, they are not the same. Labels are used for marking node instead of defining attributes.</p>
</li>
</ul>
<h3><a class="header" href="#contributors-3" id="contributors-3">Contributors</a></h3>
<ul>
<li>Chung Quan Tin (<a href="https://github.com/chungquantin">@chungquantin</a>)</li>
</ul>
<hr />
<h2><a class="header" href="#commits-on-nov-6-2022" id="commits-on-nov-6-2022">Commits on Nov 6, 2022</a></h2>
<h3><a class="header" href="#description-4" id="description-4">Description</a></h3>
<ul>
<li>Write DEVLOG for 2022 October CHANGLOG and November 1st commits</li>
</ul>
<h3><a class="header" href="#detail-explanation-3" id="detail-explanation-3">Detail explanation</a></h3>
<p>In facts, I did try to add a Github Actions workflows to auto generate Github CHANGELOG. However, it did not work as expected so I just decide to write CHANGELOG on my own.</p>
<pre><code class="language-yaml">name: Changelog
on:
    release:
        types:
            - created
jobs:
    changelog:
        runs-on: ubuntu-20.04
        steps:
            - name: &quot;✏️ Generate release changelog&quot;
              uses: heinrichreimer/github-changelog-generator-action@v2.3
              with:
                  token: ${{ secrets.GITHUB_TOKEN }}
</code></pre>
<h3><a class="header" href="#contributors-4" id="contributors-4">Contributors</a></h3>
<ul>
<li>Chung Quan Tin (<a href="https://github.com/chungquantin">@chungquantin</a>)</li>
</ul>
<hr />
<h2><a class="header" href="#commits-on-nov-7-2022" id="commits-on-nov-7-2022">Commits on Nov 7, 2022</a></h2>
<h3><a class="header" href="#description-5" id="description-5">Description</a></h3>
<ul>
<li>Updating Rust compiler version to support new feature in Rust <code>1.65.0</code>: <code>Generic Associated Type</code>.</li>
<li>Adding <code>CassandraDB</code></li>
<li>Write two new methods for <code>Vertex</code> controller</li>
</ul>
<h3><a class="header" href="#detail-explanation-4" id="detail-explanation-4">Detail explanation</a></h3>
<p>Generic Associated Type is not new and it is common in Rust <code>nightly</code> channel. However, it was only officially released to <code>stable</code> channel in the latest version. Based on the given definition:</p>
<blockquote>
<p>Generic associated types are an extension that permit associated types to have generic parameters. This allows associated types to capture types that may include generic parameters that came from a trait method. These can be lifetime or type parameters.</p>
</blockquote>
<p>Here is how GAT used in SolomonDB code. We no longer have to care about <code>Generic Type</code> passed between structs. On the other hand, <code>GAT Transaction</code> force all implemented <code>Transaction</code> type to be SimpleTransaction.</p>
<pre><code class="language-diff">#[async_trait]
- pub trait DatastoreAdapter&lt;T: SimpleTransaction&gt; {
+ pub trait DatastoreAdapter {
+   type Transaction: SimpleTransaction;
	// # Create new database transaction
	// Set `rw` default to false means readable but not readable
- fn transaction(&amp;self, rw: bool) -&gt; Result&lt;T, Error&gt;;
+ fn transaction(&amp;self, rw: bool) -&gt; Result&lt;Self::Transaction, Error&gt;;

	fn default() -&gt; Self;
</code></pre>
<p>With GAT, we can make a fully reusable struct <code>DatastoreAdapter</code> and get rid of declaring <code>Transaction</code> generic type like <code>RocksDBTransaction</code>. The implementation of <code>DatastoreAdapter</code> instance for <code>RocksDB</code> will be</p>
<pre><code class="language-diff">#[async_trait]
- impl DatastoreAdapter&lt;RocksDBTransaction&gt; for RocksDBAdapter {
+ impl DatastoreAdapter for RocksDBAdapter {
+ type Transaction = RocksDBTransaction;

	fn default() -&gt; Self {
		let path = &amp;RocksDBAdapter::generate_path(None);
		RocksDBAdapter::new(path, None).unwrap()
</code></pre>
<p>Super clean right? Worth a try if you have not updated yet.</p>
<h3><a class="header" href="#contributors-5" id="contributors-5">Contributors</a></h3>
<ul>
<li>Chung Quan Tin (<a href="https://github.com/chungquantin">@chungquantin</a>)</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../../../devlog/2022/october/w1.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../../../devlog/2022/november/w3.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../../../devlog/2022/october/w1.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../../../devlog/2022/november/w3.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
